# üåç Total Fertility Rate (TFR) Analytics Dashboard

**CIS Software Engineering Final Exam 2025**

A comprehensive three-tier web application for analyzing global Total Fertility Rate data with full CRUD operations, built using Express.js, HTMX, SQLite, and Docker.

---

## üìä Project Overview

This application provides an interactive dashboard for exploring demographic trends through Total Fertility Rate (TFR) data across countries, regions, and time periods. The system implements a normalized database design (3NF) with 8 key features including data visualization, search, analysis, and full CRUD operations.

### Key Features

‚úÖ **Requirement 1**: Country TFR History (Descending Order)  
‚úÖ **Requirement 2**: Sub-region Country Rankings (Ascending by TFR)  
‚úÖ **Requirement 3**: Regional Average TFR Analysis  
‚úÖ **Requirement 4**: Keyword Search with Latest TFR  
‚úÖ **Requirement 5**: Add Next Year TFR Record  
‚úÖ **Requirement 6**: Update Existing TFR Records  
‚úÖ **Requirement 7**: Delete TFR Records by Year Range  
‚úÖ **Requirement 8**: Global Trends Visualization (Custom Feature)

---

## üóÑÔ∏è Database Design (3rd Normal Form)

### Entity-Relationship Diagram

```mermaid
erDiagram
    REGIONS ||--o{ SUBREGIONS : contains
    REGIONS ||--o{ COUNTRIES : "belongs to"
    SUBREGIONS ||--o{ INTERMEDIATE_REGIONS : contains
    SUBREGIONS ||--o{ COUNTRIES : "belongs to"
    INTERMEDIATE_REGIONS ||--o{ COUNTRIES : "belongs to"
    COUNTRIES ||--o{ TFR_RECORDS : has
    
    REGIONS {
        int id PK
        string name
        string iso_region_code
    }
    
    SUBREGIONS {
        int id PK
        string name
        string iso_subregion_code
        int region_id FK
    }
    
    INTERMEDIATE_REGIONS {
        int id PK
        string name
        string iso_intermediate_code
        int subregion_id FK
    }
    
    COUNTRIES {
        int id PK
        string name
        string alpha2
        string alpha3
        int country_code
        string iso_3166_2
        int region_id FK
        int subregion_id FK
        int intermediate_region_id FK
    }
    
    TFR_RECORDS {
        int id PK
        int country_id FK
        int year
        float tfr
    }
```

### Normalization Compliance

- **1NF**: All attributes are atomic, no repeating groups
- **2NF**: No partial dependencies; all non-key attributes fully depend on primary key
- **3NF**: No transitive dependencies; no non-key attribute depends on another non-key attribute
- **Entities**: 5 tables (regions, subregions, intermediate_regions, countries, tfr_records)

---

## üöÄ Quick Start

### Prerequisites

- Docker Desktop installed
- Git installed
- Ports 3000 available

### Installation & Running

```bash
# 1. Clone the repository
git clone https://github.com/seizuto/cis-exam.git
cd cis-exam

# 2. Start the application
docker compose up

# 3. Access the application
# Open browser to: http://localhost:3000
```

That's it! The application will automatically:
- Build the Docker container
- Initialize the SQLite database
- Load and transform CSV data (ETL)
- Start the web server

### Manual Installation (Without Docker)

```bash
# Install dependencies
npm install

# Ensure data files exist in ./data/ directory
# - data1.csv (TFR records)
# - data2.csv (Geographic data)

# Start server
npm start

# Access at http://localhost:3000
```

---

## üìÅ Project Structure

```
/cis-exam
‚îÇ
‚îú‚îÄ‚îÄ /data                    <-- üìÇ Folder for Data
‚îÇ   ‚îú‚îÄ‚îÄ data1.csv            (Original TFR Data)
‚îÇ   ‚îú‚îÄ‚îÄ data2.csv            (Original Regions Data)
‚îÇ   ‚îî‚îÄ‚îÄ tfr_database.sqlite  (The database file generated by your code)
‚îÇ
‚îú‚îÄ‚îÄ /public                  <-- üìÇ Folder for Static Files
‚îÇ   ‚îî‚îÄ‚îÄ style.css            (Optional custom CSS)
‚îÇ
‚îú‚îÄ‚îÄ /routes                  <-- üìÇ Folder for Logic (Tier 2)
‚îÇ   ‚îú‚îÄ‚îÄ api.js               (Handles data calculations & CRUD)
‚îÇ   ‚îî‚îÄ‚îÄ frontend.js          (Handles HTML generation)
‚îÇ
‚îú‚îÄ‚îÄ /views                   <-- üìÇ Folder for Layouts (Tier 1)
‚îÇ   ‚îî‚îÄ‚îÄ layout.js            (The HTML shell: <head>, nav, footer)
‚îÇ
‚îú‚îÄ‚îÄ compose.yaml             (Docker Compose configuration)
‚îú‚îÄ‚îÄ database.js              (Database connection & ETL logic)
‚îú‚îÄ‚îÄ Dockerfile               (Docker image instructions)
‚îú‚îÄ‚îÄ ETL.sql                  (Required for the exam: SQL commands text)
‚îú‚îÄ‚îÄ package.json             (Project dependencies)
‚îú‚îÄ‚îÄ README.md                (Project documentation)
‚îî‚îÄ‚îÄ server.js                (Main entry point)
```

---

## üîß Technology Stack

### Backend
- **Node.js 18+** - JavaScript runtime
- **Express.js 4.x** - Web framework
- **SQLite3** - Embedded database
- **csv-parser** - CSV data processing

### Frontend
- **HTMX 1.9** - Dynamic HTML without heavy JavaScript
- **Tailwind CSS 3.x** - Utility-first CSS framework
- **Chart.js 4.x** - Data visualization
- **jsvectormap** - Interactive world map library
- **Hyperscript** - Client-side scripting

### DevOps
- **Docker & Docker Compose** - Containerization
- **Alpine Linux** - Lightweight base image

---

## üìã Feature Documentation

### 1Ô∏è‚É£ Country History (Requirement 1)

Displays TFR trends over time for a selected country in **descending year order**.

**Usage**: Select a country from dropdown ‚Üí View line chart

**Implementation**: 
```sql
SELECT year, tfr 
FROM tfr_records 
WHERE country_id = ? 
ORDER BY year DESC
```

---

### 2Ô∏è‚É£ Sub-region Analysis (Requirement 2)

Shows all countries in a sub-region for a specific year, ordered by **ascending TFR**.

**Usage**: Select sub-region + year ‚Üí View ranked list

**Implementation**:
```sql
SELECT c.name, t.tfr
FROM countries c
JOIN tfr_records t ON c.id = t.country_id
WHERE c.subregion_id = ? AND t.year = ?
ORDER BY t.tfr ASC
```

---

### 3Ô∏è‚É£ Regional Averages (Requirement 3)

Calculates average TFR for all sub-regions within a region for a given year.

**Usage**: Select region + year ‚Üí View aggregated averages

**Implementation**:
```sql
SELECT s.name, AVG(t.tfr) as avg
FROM subregions s
JOIN countries c ON s.id = c.subregion_id
JOIN tfr_records t ON c.id = t.country_id
WHERE s.region_id = ? AND t.year = ?
GROUP BY s.id
ORDER BY s.region_id, avg
```

---

### 4Ô∏è‚É£ Country Search (Requirement 4)

Searches countries by partial name match and displays their **latest TFR** (not hardcoded to 2023).

**Usage**: Type country name ‚Üí See real-time results

**Implementation**:
```sql
SELECT c.name,
       (SELECT tfr FROM tfr_records 
        WHERE country_id = c.id 
        ORDER BY year DESC LIMIT 1) as latest_tfr
FROM countries c
WHERE c.name LIKE ?
ORDER BY c.name
```

---

### 5Ô∏è‚É£ Add Next Year (Requirement 5)

Adds a new TFR record for the next year using the previous year's value.

**Usage**: Select country ‚Üí Click Add ‚Üí New record created

**Validation**: 
- Checks if country has existing data
- Uses last known TFR value
- Prevents duplicate year entries

---

### 6Ô∏è‚É£ Update Record (Requirement 6)

Updates an existing TFR value for a specific country and year.

**Usage**: Select country + year + new TFR ‚Üí Click Update

**Validation**:
- Year must exist for that country
- TFR must be between 0 and 15

---

### 7Ô∏è‚É£ Delete Range (Requirement 7)

Deletes all TFR records for a country within a specified year range.

**Usage**: Select country + start year + end year ‚Üí Confirm deletion

**Safety**: Confirmation dialog prevents accidental deletion

---

### 8Ô∏è‚É£ Global Trends (Requirement 8 - Custom Feature)

Visualizes TFR trends across all regions over a custom time period.

**Usage**: Enter start/end years ‚Üí Click Analyze ‚Üí View multi-line chart

**Features**:
- Compare regional fertility trends
- Adjustable time range
- Color-coded by region
- Interactive Chart.js visualization

---

### üé® Custom Features (Beyond Requirements)

#### **Feature A: Country Comparison**
Compare TFR trends between two countries side-by-side with interactive visualization.

**Usage**: Select two different countries ‚Üí View dual-line comparison chart

**Features**:
- Side-by-side trend comparison
- Percentage difference calculation
- Synchronized time axis
- Latest year statistical summary

**Implementation**:
```javascript
// Compare endpoint with dual datasets
router.get('/compare', ...)
```

---

#### **Feature B: Interactive World Map**
Global TFR heatmap using jsVectorMap with color-coded countries.

**Usage**: Select year ‚Üí View world map with TFR intensity

**Color Scale**:
- üü¢ Green (High): TFR ‚â• 3.0
- üü¢ Light Green: TFR 2.1-3.0 (Above Replacement)
- üü† Orange: TFR 1.5-2.1 (Replacement Level)
- üî¥ Red (Low): TFR < 1.5
- ‚ö™ Gray: No Data

**Features**:
- Interactive pan and zoom
- Hover tooltips with country details
- Dynamic legend
- Responsive design

---

#### **Feature C: Linear Forecast**
Predicts next 5 years of TFR using linear regression on the last 10 years.

**Usage**: Select country ‚Üí View historical + predicted trends

**Statistical Method**:
- Uses least-squares linear regression
- Requires minimum 5 years of data
- Calculates trend direction and annual change rate
- Displays confidence with dashed forecast line

**Features**:
- Visual separation between historical and forecast
- Trend analysis (increasing/decreasing)
- Annual percentage change indicator
- 5-year forward projection

---

## üéØ Feature Summary Table

| Feature | Type | Description | Visualization |
|---------|------|-------------|---------------|
| **Req 1** | Query | Country TFR History | Line Chart |
| **Req 2** | Query | Sub-region Rankings | Ranked List |
| **Req 3** | Query | Regional Averages | Grouped List |
| **Req 4** | Search | Keyword Search | Live Results |
| **Req 5** | CRUD | Add Next Year | Auto-increment |
| **Req 6** | CRUD | Update Record | Form Update |
| **Req 7** | CRUD | Delete Range | Batch Delete |
| **Req 8** | Custom | Global Trends | Multi-line Chart |
| **Feature A** | Bonus | Country Comparison | Dual-line Chart |
| **Feature B** | Bonus | World Heatmap | Interactive Map |
| **Feature C** | Bonus | Linear Forecast | Predictive Chart |

**Total**: 8 Required + 3 Bonus = **11 Features** ‚ú®

---

## üîê Data Quality & Validation

### ETL Process

1. **Extract**: Read CSV files with BOM handling
2. **Transform**: 
   - Clean headers (trim whitespace, remove BOM)
   - Validate data types
   - Remove invalid records (NULL, negative, out of range)
3. **Load**: Use transactions for atomicity

### Data Validation Rules

- **TFR**: Must be between 0 and 15
- **Year**: Must be between 1900 and 2100
- **Countries**: Unique alpha-3 codes
- **Referential Integrity**: All foreign keys enforced

### Performance Optimizations

- 6 strategic indexes on frequently queried columns
- Transaction-based bulk inserts
- Connection pooling
- Query result caching where appropriate

---

## üß™ Testing

### Manual Testing Checklist

- [ ] All 8 requirements functional
- [ ] Charts render correctly
- [ ] CRUD operations work without errors
- [ ] Search provides instant results
- [ ] Data validation prevents invalid inputs
- [ ] Docker deployment works on fresh machine
- [ ] All dropdowns populated correctly
- [ ] Toast notifications appear for actions

### Sample Test Queries

```bash
# Test Req 1: View USA history
curl "http://localhost:3000/api/history?country_id=1"

# Test Req 4: Search for "United"
curl "http://localhost:3000/api/search?search=United"

# Test Req 5: Add next year for USA
curl -X POST http://localhost:3000/api/add-year \
  -H "Content-Type: application/json" \
  -d '{"country_id": 1}'
```

---

## üìà Data Sources

- **TFR Statistics**: [Our World in Data](https://ourworldindata.org/)
- **Geographic Metadata**: [Kaggle](https://www.kaggle.com/)

### Data Fields

**data1.csv** (TFR Records):
- Entity, Code (alpha-3), Year, TFR

**data2.csv** (Geography):
- name, alpha-2, alpha-3, region, sub-region

---

## üêõ Troubleshooting

### Issue: Port 3000 already in use
```bash
# Stop existing container
docker compose down

# Or use different port
# Edit compose.yaml: ports: "3001:3000"
```

### Issue: Database not loading
```bash
# Remove database and restart
rm data/tfr_database.sqlite
docker compose up --build
```

### Issue: CSV files not found
```bash
# Ensure files exist
ls -la data/
# Should show: data1.csv, data2.csv
```

---

## üë®‚Äçüíª Development Notes

### Code Quality
- Clean, readable code with comments
- Consistent naming conventions
- Error handling for all database operations
- Input validation on all forms

### Future Enhancements
- [ ] Export data to CSV
- [ ] User authentication
- [ ] Advanced filtering options
- [ ] Predictive modeling
- [ ] Mobile responsive improvements
- [ ] API rate limiting
- [ ] Unit tests with Jest

---

## üôè Acknowledgments

- **Course**: Software Engineering in CIS
- **Instructor**: Yo-Ming Hsieh
- **Institution**: National Taiwan University of Science and Technology
- **Year**: 2025

---

## üìß Contact

- **Student Name**: Steven Gaillard
- **Student ID**: D11405806
- **Email**: gacchuguts@gmail.com

---

**Note**: This project demonstrates database normalization, ETL processes, RESTful API design, modern web development with HTMX, and containerized deployment with Docker.
